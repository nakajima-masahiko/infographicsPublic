<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FXテクニカル指標デモ（ECharts）</title>
  <style>
    :root {
      color-scheme: light;
      font-family: "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: #0f172a;
      color: #e2e8f0;
    }
    header {
      background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
      padding: 32px 20px;
      text-align: center;
    }
    header h1 {
      margin: 0 0 12px;
      font-size: 28px;
      letter-spacing: 0.04em;
    }
    header p {
      margin: 0 auto;
      max-width: 760px;
      line-height: 1.7;
      color: rgba(255, 255, 255, 0.85);
      font-size: 14px;
    }
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 20px 60px;
    }
    .section {
      margin-bottom: 28px;
      background: #111827;
      border: 1px solid #1f2937;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.45);
    }
    .section h2 {
      margin: 0 0 12px;
      font-size: 20px;
      color: #f8fafc;
    }
    .section p {
      margin: 0 0 12px;
      color: #cbd5f5;
      line-height: 1.7;
      font-size: 14px;
    }
    .desc-detail {
      background: rgba(30, 41, 59, 0.6);
      border-left: 3px solid #6366f1;
      padding: 14px 18px;
      margin: 12px 0 16px;
      border-radius: 0 10px 10px 0;
      font-size: 13px;
      line-height: 1.8;
      color: #c7d2fe;
    }
    .desc-detail strong {
      color: #a5b4fc;
    }
    .desc-detail ul {
      margin: 6px 0 0;
      padding-left: 18px;
    }
    .desc-detail li {
      margin-bottom: 4px;
    }
    .chart-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    .chart-panel {
      background: #0b1220;
      border: 1px solid #1e293b;
      border-radius: 14px;
      padding: 16px;
    }
    .chart-panel h3 {
      margin: 0 0 8px;
      font-size: 16px;
      color: #e2e8f0;
    }
    .chart {
      width: 100%;
      height: 320px;
    }
    .chart.small {
      height: 240px;
    }
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 12px;
      font-size: 12px;
      color: #94a3b8;
    }
    .legend span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
    }
    .dot.candle { background: #38bdf8; }
    .dot.ma5 { background: #facc15; }
    .dot.ma20 { background: #a855f7; }
    .dot.rsi { background: #34d399; }
    .dot.macd { background: #f97316; }
    .dot.signal { background: #60a5fa; }
    .dot.stoch-k { background: #f472b6; }
    .dot.stoch-d { background: #fbbf24; }
    .dot.bb-upper { background: #818cf8; }
    .dot.bb-mid { background: #fb923c; }
    .dot.bb-lower { background: #818cf8; }
    .dot.bb-fill { background: rgba(129, 140, 248, 0.25); }
    .dot.ichi-tenkan { background: #f87171; }
    .dot.ichi-kijun { background: #60a5fa; }
    .dot.ichi-span-a { background: #4ade80; }
    .dot.ichi-span-b { background: #fb923c; }
    .dot.ichi-chikou { background: #c084fc; }
    .dot.ichi-cloud { background: rgba(99, 102, 241, 0.25); }
    .note {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 13px;
      color: #bfdbfe;
    }
    footer {
      text-align: center;
      color: #94a3b8;
      font-size: 12px;
      margin-top: 28px;
    }
  </style>
</head>
<body>
  <header>
    <h1>FXチャートの代表的なテクニカル指標</h1>
    <p>
      ECharts の JavaScript ライブラリを使って、ローソク足・移動平均線・RSI・MACD・ストキャスティクス・ボリンジャーバンド・一目均衡表を
      サンプルデータで可視化する方法をまとめたデモ資料です。
    </p>
  </header>

  <main>
    <!-- ===== 1. ローソク足 & 移動平均線 ===== -->
    <section class="section">
      <h2>1. ローソク足 & 移動平均線（MA）</h2>
      <p>
        ローソク足は「始値・高値・安値・終値」の4本値をまとめて表示するチャートの基本形です。
        移動平均線（Moving Average）はトレンドの方向感を把握するために利用され、短期（5日）と中期（20日）を重ねることが一般的です。
      </p>
      <div class="desc-detail">
        <strong>専門解説</strong>
        <ul>
          <li><strong>ローソク足の構造：</strong>実体（始値〜終値の幅）とヒゲ（高値・安値への延長線）で構成されます。陽線（終値 &gt; 始値）は買い圧力、陰線（終値 &lt; 始値）は売り圧力を示し、ヒゲの長さは一時的な価格到達と反発の強さを表します。</li>
          <li><strong>移動平均線（SMA）：</strong>過去 N 日間の終値の算術平均。短期線が長期線を下から上に突き抜ける「ゴールデンクロス」は買いシグナル、逆の「デッドクロス」は売りシグナルと解釈されます。</li>
          <li><strong>EMA（指数移動平均）との違い：</strong>SMA は全期間の終値を等しく重み付けしますが、EMA は直近のデータに大きな重みを与えるため、トレンド変化に対してより早く反応します。</li>
          <li><strong>グランビルの法則：</strong>移動平均線と価格の位置関係から、売買タイミングを判定する8つのパターンが提唱されています。</li>
        </ul>
      </div>
      <div class="chart-panel">
        <h3>サンプル：USD/JPY 12日分</h3>
        <div id="chart-candles" class="chart"></div>
        <div class="legend">
          <span><span class="dot candle"></span>ローソク足</span>
          <span><span class="dot ma5"></span>MA 5</span>
          <span><span class="dot ma20"></span>MA 20</span>
        </div>
      </div>
      <div class="note">
        ECharts では <code>candlestick</code> シリーズと <code>line</code> シリーズを同一グリッド上に重ねて描画します。<code>tooltip</code> の <code>trigger: 'axis'</code> により、カーソル位置の全系列データを一括表示できます。<code>dataZoom</code> を追加すればスクロール・ズームも可能です。
      </div>
    </section>

    <!-- ===== 2. RSI ===== -->
    <section class="section">
      <h2>2. RSI（相対力指数 / Relative Strength Index）</h2>
      <p>
        RSI は買われすぎ・売られすぎを判断するオシレーター指標で、0〜100 の範囲で推移します。
        一般に 70 以上で「買われすぎ」、30 以下で「売られすぎ」と解釈されます。
      </p>
      <div class="desc-detail">
        <strong>専門解説</strong>
        <ul>
          <li><strong>算出式：</strong>RSI = 100 - 100 / (1 + RS)。RS = N 期間の平均上昇幅 / N 期間の平均下降幅。標準的には N = 14 を使用します。</li>
          <li><strong>ダイバージェンス：</strong>価格が新高値を更新しているのに RSI が前回高値を下回る場合（弱気ダイバージェンス）、トレンドの反転を示唆します。逆パターンは強気ダイバージェンスです。</li>
          <li><strong>フェイラースイング：</strong>RSI が 70 を超えた後に下落し、再上昇しても 70 を超えられず再下落するパターン。ワイルダーが提唱した強力な反転シグナルとされます。</li>
          <li><strong>注意点：</strong>強いトレンド相場では RSI が 70 以上（または 30 以下）に張り付くことがあり、逆張りシグナルとして機能しにくくなります。レンジ相場での利用が適しています。</li>
        </ul>
      </div>
      <div class="chart-panel">
        <h3>RSI 14（擬似データ）</h3>
        <div id="chart-rsi" class="chart small"></div>
        <div class="legend">
          <span><span class="dot rsi"></span>RSI 14</span>
        </div>
      </div>
      <div class="note">
        ECharts の <code>markLine</code> を使用して 70 / 30 の閾値ラインを描画し、<code>markArea</code> で買われすぎ・売られすぎゾーンを視覚的に色分けしています。<code>areaStyle</code> で線の下を半透明で塗りつぶし、勢いの強さを直感的に把握できるようにしています。
      </div>
    </section>

    <!-- ===== 3. MACD ===== -->
    <section class="section">
      <h2>3. MACD（移動平均収束拡散 / Moving Average Convergence Divergence）</h2>
      <p>
        MACD は短期 EMA と長期 EMA の差（MACD 線）と、その移動平均であるシグナル線を比較し、トレンドの発生・転換を探ります。
      </p>
      <div class="desc-detail">
        <strong>専門解説</strong>
        <ul>
          <li><strong>算出式：</strong>MACD 線 = EMA(12) - EMA(26)。シグナル線 = MACD 線の EMA(9)。ヒストグラム = MACD 線 - シグナル線。</li>
          <li><strong>クロスオーバー：</strong>MACD 線がシグナル線を上抜け（ゴールデンクロス）で買い、下抜け（デッドクロス）で売りと判断します。ゼロライン付近でのクロスは特にトレンド転換の信頼度が高いとされます。</li>
          <li><strong>ヒストグラムの解釈：</strong>ヒストグラムが正から負に転じるとき売り圧力増加、負から正に転じるとき買い圧力増加を示します。ヒストグラムの山・谷の大きさはモメンタムの強さを反映します。</li>
          <li><strong>ダイバージェンス：</strong>RSI 同様、価格とMACDの方向が乖離する場合はトレンド反転の兆候と解釈されます。</li>
          <li><strong>注意点：</strong>MACD は遅行指標であるため、急激な相場変動の初動を捉えにくい面があります。他の先行指標との組み合わせが推奨されます。</li>
        </ul>
      </div>
      <div class="chart-grid">
        <div class="chart-panel">
          <h3>MACD & シグナル</h3>
          <div id="chart-macd" class="chart small"></div>
          <div class="legend">
            <span><span class="dot macd"></span>MACD</span>
            <span><span class="dot signal"></span>Signal</span>
          </div>
        </div>
        <div class="chart-panel">
          <h3>ヒストグラム</h3>
          <div id="chart-hist" class="chart small"></div>
        </div>
      </div>
      <div class="note">
        ECharts では MACD とシグナルを <code>line</code> シリーズ、ヒストグラムを <code>bar</code> シリーズで描画します。<code>itemStyle.color</code> にコールバック関数を渡すことで、正負の値に応じた色分け（青 / 赤）を動的に適用しています。<code>markLine</code> でゼロラインを明示すると判読性が向上します。
      </div>
    </section>

    <!-- ===== 4. ストキャスティクス ===== -->
    <section class="section">
      <h2>4. ストキャスティクス（Stochastic Oscillator）</h2>
      <p>
        ストキャスティクスは、一定期間の価格レンジにおける現在の終値の相対的な位置を 0〜100 の範囲で示すオシレーター指標です。
        %K（ファスト）と %D（スロー）の 2 本のラインを使って売買タイミングを判定します。
      </p>
      <div class="desc-detail">
        <strong>専門解説</strong>
        <ul>
          <li><strong>算出式：</strong>%K = (現在の終値 - N 日間の最安値) / (N 日間の最高値 - N 日間の最安値) &times; 100。標準期間は N = 14。%D は %K の M 日間（通常 M = 3）の単純移動平均です。</li>
          <li><strong>ファスト vs スロー：</strong>ファストストキャスティクスは %K と %D をそのまま使用。スローストキャスティクスは %D を新たな %K とし、さらにその SMA を %D とします。スローの方がノイズが少なく実践的に多用されます。</li>
          <li><strong>売買シグナル：</strong>%K が %D を下から上に突き抜ける（ゴールデンクロス）かつ 20 以下のゾーンで発生した場合は強い買いシグナル。逆に 80 以上でデッドクロスが発生すれば強い売りシグナルです。</li>
          <li><strong>ダイバージェンス：</strong>RSI と同様に、価格とストキャスティクスの方向が乖離する場合はトレンド反転の兆候と解釈されます。</li>
          <li><strong>注意点：</strong>強いトレンド相場では 80 以上 / 20 以下に張り付くことがあり、レンジ相場での利用が適しています。RSI と組み合わせて確認することが推奨されます。</li>
        </ul>
      </div>
      <div class="chart-panel">
        <h3>ストキャスティクス %K / %D（擬似データ）</h3>
        <div id="chart-stoch" class="chart small"></div>
        <div class="legend">
          <span><span class="dot stoch-k"></span>%K（ファスト）</span>
          <span><span class="dot stoch-d"></span>%D（スロー）</span>
        </div>
      </div>
      <div class="note">
        ECharts の <code>markArea</code> を使用して 80 以上（買われすぎ）と 20 以下（売られすぎ）のゾーンを半透明の背景色で視覚化しています。<code>markLine</code> で閾値ラインを破線で描画し、%K と %D のクロスポイントが一目で判別できるようにしています。
      </div>
    </section>

    <!-- ===== 5. ボリンジャーバンド ===== -->
    <section class="section">
      <h2>5. ボリンジャーバンド（Bollinger Bands）</h2>
      <p>
        ボリンジャーバンドは、移動平均線を中心に標準偏差（&sigma;）で算出した上下バンドを描き、
        価格の変動幅（ボラティリティ）を視覚化する指標です。ジョン・ボリンジャーが開発しました。
      </p>
      <div class="desc-detail">
        <strong>専門解説</strong>
        <ul>
          <li><strong>算出式：</strong>ミドルバンド = SMA(N)（通常 N = 20）。アッパーバンド = SMA(N) + K &times; &sigma;（通常 K = 2）。ロワーバンド = SMA(N) - K &times; &sigma;。&sigma; は N 期間の終値の標準偏差です。</li>
          <li><strong>統計的意味：</strong>&plusmn;1&sigma; に約 68.3%、&plusmn;2&sigma; に約 95.4% の価格が収まるとされます（正規分布仮定）。バンドの外に価格が出ることは統計的に稀なイベントです。</li>
          <li><strong>スクイーズ（収縮）：</strong>バンド幅が狭くなる「スクイーズ」は、低ボラティリティ状態を示し、近い将来の大きな値動き（ブレイクアウト）の予兆とされます。</li>
          <li><strong>エクスパンション（拡大）：</strong>バンド幅が急激に広がる状態はボラティリティの増大を示し、トレンドの発生を示唆します。</li>
          <li><strong>バンドウォーク：</strong>強いトレンドが発生すると、価格がアッパー（またはロワー）バンドに沿って推移する現象。トレンド継続のサインです。</li>
          <li><strong>%B 指標：</strong>%B = (価格 - ロワーバンド) / (アッパーバンド - ロワーバンド)。現在価格がバンド内のどの位置にあるかを 0〜1 で示します。</li>
        </ul>
      </div>
      <div class="chart-panel">
        <h3>ボリンジャーバンド（&plusmn;2&sigma;）& ローソク足</h3>
        <div id="chart-bb" class="chart"></div>
        <div class="legend">
          <span><span class="dot candle"></span>ローソク足</span>
          <span><span class="dot bb-mid"></span>ミドル（SMA 20）</span>
          <span><span class="dot bb-upper"></span>アッパー（+2&sigma;）</span>
          <span><span class="dot bb-lower"></span>ロワー（-2&sigma;）</span>
          <span><span class="dot bb-fill"></span>バンド範囲</span>
        </div>
      </div>
      <div class="note">
        ECharts ではアッパーバンドとロワーバンドの間の範囲を表現するために、ロワーバンドの <code>areaStyle</code> で塗りつぶしを行い、アッパーバンドの <code>areaStyle</code> で背景色と同色で上書きすることでバンド領域を可視化しています。<code>candlestick</code> シリーズと重ねて表示することで、価格がバンドに対してどの位置にあるかを直感的に把握できます。
      </div>
    </section>

    <!-- ===== 6. 一目均衡表 ===== -->
    <section class="section">
      <h2>6. 一目均衡表（Ichimoku Kinko Hyo）</h2>
      <p>
        一目均衡表は、日本の株式評論家・細田悟一（ペンネーム：一目山人）が約20年の歳月をかけて開発したテクニカル指標です。
        「相場の均衡状態を一目で把握する」ことを目指し、5本の線と「雲（くも）」で構成されます。
        時間論・波動論・値幅観測論の3つの理論を基盤とし、世界中のトレーダーに利用されています。
      </p>
      <div class="desc-detail">
        <strong>専門解説</strong>
        <ul>
          <li><strong>転換線（Tenkan-sen）：</strong>過去9期間の最高値と最安値の中間値。短期的なトレンド方向を示します。（9期間高値 + 9期間安値）/ 2</li>
          <li><strong>基準線（Kijun-sen）：</strong>過去26期間の最高値と最安値の中間値。中期的なトレンドの基準となり、サポート／レジスタンスとして機能します。（26期間高値 + 26期間安値）/ 2</li>
          <li><strong>先行スパンA（Senkou Span A）：</strong>転換線と基準線の中間値を26期間先行させてプロット。雲の一辺を形成します。（転換線 + 基準線）/ 2</li>
          <li><strong>先行スパンB（Senkou Span B）：</strong>過去52期間の最高値と最安値の中間値を26期間先行させてプロット。雲のもう一辺を形成します。（52期間高値 + 52期間安値）/ 2</li>
          <li><strong>遅行スパン（Chikou Span）：</strong>当日の終値を26期間遅行させてプロット。過去の価格と現在の価格の比較に使用されます。</li>
          <li><strong>雲（Kumo）：</strong>先行スパンAとBの間の領域。雲の厚みはサポート／レジスタンスの強さを示し、価格が雲の上にあれば強気、下にあれば弱気と判断します。スパンAがスパンBより上なら強気の雲（好転）、下なら弱気の雲（逆転）です。</li>
          <li><strong>三役好転（強い買いシグナル）：</strong>①転換線が基準線を上抜け ②遅行スパンがローソク足を上抜け ③価格が雲を上抜け — この3条件が揃った状態。</li>
          <li><strong>三役逆転（強い売りシグナル）：</strong>三役好転の逆パターン。3条件すべてが売り方向に揃った状態。</li>
          <li><strong>時間論：</strong>一目均衡表の基本数値（9, 17, 26, 33, 42, 65, 76, 129, 172, 200〜257）を用いて、変化日（トレンド転換が起きやすい日柄）を予測します。</li>
        </ul>
      </div>
      <div class="chart-panel">
        <h3>一目均衡表（擬似データ・短縮パラメータ）</h3>
        <div id="chart-ichimoku" class="chart" style="height:380px;"></div>
        <div class="legend">
          <span><span class="dot ichi-tenkan"></span>転換線</span>
          <span><span class="dot ichi-kijun"></span>基準線</span>
          <span><span class="dot ichi-span-a"></span>先行スパンA</span>
          <span><span class="dot ichi-span-b"></span>先行スパンB</span>
          <span><span class="dot ichi-chikou"></span>遅行スパン</span>
          <span><span class="dot ichi-cloud"></span>雲（くも）</span>
        </div>
      </div>
      <div class="note">
        ECharts では転換線・基準線・先行スパン・遅行スパンを <code>line</code> シリーズで描画します。雲（くも）はボリンジャーバンドと同様の手法で、先行スパンA・Bの間を <code>areaStyle</code> の塗り重ねにより表現しています。先行スパンは <code>xAxis</code> のカテゴリデータをデータ期間＋先行期間分だけ拡張し、各配列の先頭を <code>null</code> で埋めることで未来方向へのシフトを実現しています。遅行スパンは逆に過去方向へシフトさせてプロットします。<br>
        ※本デモでは表示スペースの都合上、パラメータを短縮しています（転換=5, 基準=13, スパンB=26, 先行/遅行=13）。標準パラメータは 転換=9, 基準=26, スパンB=52, 先行/遅行=26 です。
      </div>
    </section>

    <!-- ===== 7. 実装ポイント ===== -->
    <section class="section">
      <h2>7. EChartsでの実装ポイント</h2>
      <ul>
        <li>CDN で <code>echarts.min.js</code> を読み込み、対象 DOM に対して <code>echarts.init()</code> で描画。</li>
        <li>ローソク足は <code>candlestick</code> シリーズ、移動平均線・ボリンジャーバンドは <code>line</code> シリーズで重ねる。</li>
        <li><code>markLine</code> で閾値ライン（RSI の 70/30、ストキャスティクスの 80/20、MACD のゼロライン）を描画。</li>
        <li><code>markArea</code> で買われすぎ・売られすぎゾーンの背景色を設定し、視認性を向上。</li>
        <li><code>areaStyle</code> で線の下（またはバンド間）を半透明で塗りつぶし、範囲の広がりを可視化。</li>
        <li><code>tooltip</code> の <code>trigger: 'axis'</code> と <code>axisPointer</code> で、同一日付の全系列データを一括表示。</li>
        <li>RSI・MACD・ストキャスティクスは別チャートにし、スクロールや同期を <code>dataZoom</code> で制御すると扱いやすい。</li>
        <li><code>itemStyle.color</code> にコールバック関数を渡すことで、正負やクロス判定に応じた動的な色分けが可能。</li>
        <li>一目均衡表の雲は先行スパンA・Bの <code>areaStyle</code> 塗り重ねで表現し、先行・遅行のシフトは <code>xAxis</code> カテゴリの拡張と配列の <code>null</code> パディングで実現。</li>
        <li><code>window.addEventListener('resize', ...)</code> で全チャートに <code>.resize()</code> を呼ぶことでレスポンシブ対応。</li>
      </ul>
    </section>

    <footer>Sample data &copy; 2026 FX Technical Indicators Demo</footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script>
    /* ========================================
       共通データ
    ======================================== */
    const dates = ['09/02','09/03','09/04','09/05','09/06','09/09','09/10','09/11','09/12','09/13','09/16','09/17'];
    // [open, close, low, high] — ECharts candlestick format
    const candleData = [
      [147.8, 148.6, 147.4, 148.2],
      [148.2, 149.1, 147.9, 148.9],
      [148.9, 149.4, 148.1, 148.4],
      [148.4, 149.0, 147.6, 147.9],
      [147.9, 148.5, 147.2, 148.1],
      [148.1, 148.8, 147.7, 148.4],
      [148.4, 149.3, 148.0, 149.0],
      [149.0, 149.6, 148.5, 149.2],
      [149.2, 149.9, 148.8, 149.6],
      [149.6, 150.1, 149.0, 149.3],
      [149.3, 149.8, 148.6, 149.0],
      [149.0, 149.5, 148.4, 148.7]
    ];

    const closeValues = candleData.map(item => item[1]);
    const highValues  = candleData.map(item => item[3]);
    const lowValues   = candleData.map(item => item[2]);

    const calcMA = (dayCount) => closeValues.map((_, idx) => {
      if (idx < dayCount - 1) return null;
      const slice = closeValues.slice(idx - dayCount + 1, idx + 1);
      return +(slice.reduce((a, b) => a + b, 0) / dayCount).toFixed(2);
    });

    /* ========================================
       1. ローソク足 & MA
    ======================================== */
    const chartCandles = echarts.init(document.getElementById('chart-candles'));
    chartCandles.setOption({
      backgroundColor: 'transparent',
      tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'cross' }
      },
      legend: { show: false },
      xAxis: {
        type: 'category',
        data: dates,
        boundaryGap: true,
        axisLabel: { color: '#94a3b8' },
        axisLine: { lineStyle: { color: '#334155' } }
      },
      yAxis: {
        scale: true,
        axisLabel: { color: '#94a3b8' },
        splitLine: { lineStyle: { color: '#1e293b' } }
      },
      grid: { left: 50, right: 20, bottom: 30, top: 20 },
      series: [
        {
          type: 'candlestick',
          data: candleData,
          itemStyle: {
            color: '#38bdf8',
            color0: '#f87171',
            borderColor: '#38bdf8',
            borderColor0: '#f87171'
          }
        },
        {
          name: 'MA5',
          type: 'line',
          data: calcMA(5),
          smooth: true,
          showSymbol: false,
          lineStyle: { width: 2, color: '#facc15' }
        },
        {
          name: 'MA20',
          type: 'line',
          data: calcMA(10),
          smooth: true,
          showSymbol: false,
          lineStyle: { width: 2, color: '#a855f7' }
        }
      ]
    });

    /* ========================================
       2. RSI
    ======================================== */
    const rsiValues = [52, 58, 49, 44, 48, 54, 60, 63, 68, 59, 51, 47];
    const chartRsi = echarts.init(document.getElementById('chart-rsi'));
    chartRsi.setOption({
      tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'line' }
      },
      xAxis: {
        type: 'category',
        data: dates,
        axisLabel: { color: '#94a3b8' },
        axisLine: { lineStyle: { color: '#334155' } }
      },
      yAxis: {
        min: 0,
        max: 100,
        axisLabel: { color: '#94a3b8' },
        splitLine: { lineStyle: { color: '#1e293b' } }
      },
      grid: { left: 40, right: 20, bottom: 30, top: 20 },
      series: [
        {
          name: 'RSI',
          type: 'line',
          data: rsiValues,
          smooth: true,
          lineStyle: { color: '#34d399', width: 2 },
          areaStyle: { color: 'rgba(52, 211, 153, 0.08)' },
          markLine: {
            silent: true,
            symbol: 'none',
            label: {
              formatter: '{b}',
              color: '#94a3b8',
              fontSize: 11
            },
            data: [
              { name: '70（買われすぎ）', yAxis: 70, lineStyle: { color: '#f87171', type: 'dashed', width: 1 } },
              { name: '30（売られすぎ）', yAxis: 30, lineStyle: { color: '#60a5fa', type: 'dashed', width: 1 } }
            ]
          },
          markArea: {
            silent: true,
            data: [
              [
                { yAxis: 70, itemStyle: { color: 'rgba(248, 113, 113, 0.06)' } },
                { yAxis: 100 }
              ],
              [
                { yAxis: 0, itemStyle: { color: 'rgba(96, 165, 250, 0.06)' } },
                { yAxis: 30 }
              ]
            ]
          }
        }
      ]
    });

    /* ========================================
       3. MACD
    ======================================== */
    const macd = [0.32, 0.45, 0.12, -0.05, 0.08, 0.18, 0.36, 0.41, 0.22, 0.05, -0.08, -0.16];
    const signal = [0.26, 0.33, 0.28, 0.14, 0.12, 0.16, 0.25, 0.32, 0.29, 0.17, 0.05, -0.02];
    const histogram = macd.map((v, i) => +(v - signal[i]).toFixed(2));

    const chartMacd = echarts.init(document.getElementById('chart-macd'));
    chartMacd.setOption({
      tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'line' }
      },
      xAxis: {
        type: 'category',
        data: dates,
        axisLabel: { color: '#94a3b8' },
        axisLine: { lineStyle: { color: '#334155' } }
      },
      yAxis: {
        axisLabel: { color: '#94a3b8' },
        splitLine: { lineStyle: { color: '#1e293b' } }
      },
      grid: { left: 40, right: 20, bottom: 30, top: 20 },
      series: [
        {
          name: 'MACD',
          type: 'line',
          data: macd,
          smooth: true,
          showSymbol: false,
          lineStyle: { color: '#f97316', width: 2 },
          markLine: {
            silent: true,
            symbol: 'none',
            label: { show: false },
            data: [
              { yAxis: 0, lineStyle: { color: '#475569', type: 'solid', width: 1 } }
            ]
          }
        },
        {
          name: 'Signal',
          type: 'line',
          data: signal,
          smooth: true,
          showSymbol: false,
          lineStyle: { color: '#60a5fa', width: 2 }
        }
      ]
    });

    const chartHist = echarts.init(document.getElementById('chart-hist'));
    chartHist.setOption({
      tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'shadow' }
      },
      xAxis: {
        type: 'category',
        data: dates,
        axisLabel: { color: '#94a3b8' },
        axisLine: { lineStyle: { color: '#334155' } }
      },
      yAxis: {
        axisLabel: { color: '#94a3b8' },
        splitLine: { lineStyle: { color: '#1e293b' } }
      },
      grid: { left: 40, right: 20, bottom: 30, top: 20 },
      series: [
        {
          type: 'bar',
          data: histogram,
          itemStyle: {
            color: (params) => params.value >= 0 ? '#38bdf8' : '#f87171'
          },
          markLine: {
            silent: true,
            symbol: 'none',
            label: { show: false },
            data: [
              { yAxis: 0, lineStyle: { color: '#475569', type: 'solid', width: 1 } }
            ]
          }
        }
      ]
    });

    /* ========================================
       4. ストキャスティクス
    ======================================== */
    // %K 計算: (終値 - N日間最安値) / (N日間最高値 - N日間最安値) * 100
    const stochPeriod = 5;
    const stochK = closeValues.map((close, idx) => {
      if (idx < stochPeriod - 1) return null;
      const highs = highValues.slice(idx - stochPeriod + 1, idx + 1);
      const lows  = lowValues.slice(idx - stochPeriod + 1, idx + 1);
      const highMax = Math.max(...highs);
      const lowMin  = Math.min(...lows);
      if (highMax === lowMin) return 50;
      return +((close - lowMin) / (highMax - lowMin) * 100).toFixed(1);
    });

    // %D = %K の 3 日 SMA
    const stochDPeriod = 3;
    const stochD = stochK.map((_, idx) => {
      if (stochK[idx] === null) return null;
      if (idx < stochPeriod - 1 + stochDPeriod - 1) return null;
      const slice = stochK.slice(idx - stochDPeriod + 1, idx + 1);
      if (slice.some(v => v === null)) return null;
      return +(slice.reduce((a, b) => a + b, 0) / stochDPeriod).toFixed(1);
    });

    const chartStoch = echarts.init(document.getElementById('chart-stoch'));
    chartStoch.setOption({
      tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'line' }
      },
      xAxis: {
        type: 'category',
        data: dates,
        axisLabel: { color: '#94a3b8' },
        axisLine: { lineStyle: { color: '#334155' } }
      },
      yAxis: {
        min: 0,
        max: 100,
        axisLabel: { color: '#94a3b8' },
        splitLine: { lineStyle: { color: '#1e293b' } }
      },
      grid: { left: 40, right: 20, bottom: 30, top: 20 },
      series: [
        {
          name: '%K',
          type: 'line',
          data: stochK,
          smooth: true,
          showSymbol: false,
          lineStyle: { color: '#f472b6', width: 2 },
          markLine: {
            silent: true,
            symbol: 'none',
            label: {
              formatter: '{b}',
              color: '#94a3b8',
              fontSize: 11
            },
            data: [
              { name: '80（買われすぎ）', yAxis: 80, lineStyle: { color: '#f87171', type: 'dashed', width: 1 } },
              { name: '20（売られすぎ）', yAxis: 20, lineStyle: { color: '#60a5fa', type: 'dashed', width: 1 } }
            ]
          },
          markArea: {
            silent: true,
            data: [
              [
                { yAxis: 80, itemStyle: { color: 'rgba(248, 113, 113, 0.06)' } },
                { yAxis: 100 }
              ],
              [
                { yAxis: 0, itemStyle: { color: 'rgba(96, 165, 250, 0.06)' } },
                { yAxis: 20 }
              ]
            ]
          }
        },
        {
          name: '%D',
          type: 'line',
          data: stochD,
          smooth: true,
          showSymbol: false,
          lineStyle: { color: '#fbbf24', width: 2 }
        }
      ]
    });

    /* ========================================
       5. ボリンジャーバンド
    ======================================== */
    const bbPeriod = 5;
    const bbK = 2;

    const bbMid = closeValues.map((_, idx) => {
      if (idx < bbPeriod - 1) return null;
      const slice = closeValues.slice(idx - bbPeriod + 1, idx + 1);
      return +(slice.reduce((a, b) => a + b, 0) / bbPeriod).toFixed(3);
    });

    const bbStdDev = closeValues.map((_, idx) => {
      if (idx < bbPeriod - 1) return null;
      const slice = closeValues.slice(idx - bbPeriod + 1, idx + 1);
      const mean = slice.reduce((a, b) => a + b, 0) / bbPeriod;
      const variance = slice.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / bbPeriod;
      return Math.sqrt(variance);
    });

    const bbUpper = bbMid.map((mid, idx) => {
      if (mid === null) return null;
      return +(mid + bbK * bbStdDev[idx]).toFixed(3);
    });

    const bbLower = bbMid.map((mid, idx) => {
      if (mid === null) return null;
      return +(mid - bbK * bbStdDev[idx]).toFixed(3);
    });

    const chartBB = echarts.init(document.getElementById('chart-bb'));
    chartBB.setOption({
      backgroundColor: 'transparent',
      tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'cross' }
      },
      legend: { show: false },
      xAxis: {
        type: 'category',
        data: dates,
        boundaryGap: true,
        axisLabel: { color: '#94a3b8' },
        axisLine: { lineStyle: { color: '#334155' } }
      },
      yAxis: {
        scale: true,
        axisLabel: { color: '#94a3b8' },
        splitLine: { lineStyle: { color: '#1e293b' } }
      },
      grid: { left: 50, right: 20, bottom: 30, top: 20 },
      series: [
        // ロワーバンド（バンド塗りつぶしのベース）
        {
          name: 'Lower',
          type: 'line',
          data: bbLower,
          smooth: true,
          showSymbol: false,
          lineStyle: { color: '#818cf8', width: 1, type: 'dashed' },
          areaStyle: {
            color: 'rgba(129, 140, 248, 0.12)',
            origin: 'auto'
          },
          z: 1
        },
        // アッパーバンド（上側を背景色で塗りつぶしてバンド外を消す）
        {
          name: 'Upper',
          type: 'line',
          data: bbUpper,
          smooth: true,
          showSymbol: false,
          lineStyle: { color: '#818cf8', width: 1, type: 'dashed' },
          areaStyle: {
            color: '#0b1220',
            origin: 'auto'
          },
          z: 2
        },
        // ミドルバンド
        {
          name: 'Middle',
          type: 'line',
          data: bbMid,
          smooth: true,
          showSymbol: false,
          lineStyle: { color: '#fb923c', width: 2 },
          z: 3
        },
        // ローソク足
        {
          type: 'candlestick',
          data: candleData,
          itemStyle: {
            color: '#38bdf8',
            color0: '#f87171',
            borderColor: '#38bdf8',
            borderColor0: '#f87171'
          },
          z: 4
        }
      ]
    });

    /* ========================================
       6. 一目均衡表（Ichimoku Kinko Hyo）
    ======================================== */
    // デモ用短縮パラメータ（標準: 転換=9, 基準=26, スパンB=52, 先行/遅行=26）
    const tenkanP = 5, kijunP = 13, spanBP = 26, ichiDisp = 13;
    const ichiN = 60;

    // 拡張日付ラベル（データ期間 ＋ 先行スパン投影分）
    const ichiDates = [];
    {
      let dt = new Date(2024, 6, 1);
      for (let i = 0; i < ichiN + ichiDisp; i++) {
        while (dt.getDay() === 0 || dt.getDay() === 6) dt.setDate(dt.getDate() + 1);
        ichiDates.push(String(dt.getMonth() + 1).padStart(2, '0') + '/' + String(dt.getDate()).padStart(2, '0'));
        dt.setDate(dt.getDate() + 1);
      }
    }

    // 擬似 OHLC データ生成（上昇→もみ合い→下降のパターン）
    const ichiCandle = [], ichiClose = [], ichiHigh = [], ichiLow = [];
    {
      let p = 147.50;
      for (let i = 0; i < ichiN; i++) {
        const drift = i < 20 ? 0.10 : i < 40 ? 0.01 * Math.sin(i * 0.6) : -0.08;
        p += drift + 0.07 * Math.sin(i * 2.3) + 0.04 * Math.sin(i * 3.7);
        const v = 0.30 + 0.12 * Math.abs(Math.sin(i * 0.6));
        const o = +p.toFixed(2);
        const h = +(p + v * (0.4 + 0.25 * Math.abs(Math.sin(i * 1.9)))).toFixed(2);
        const l = +(p - v * (0.3 + 0.20 * Math.abs(Math.sin(i * 1.3)))).toFixed(2);
        const c = +(l + (h - l) * (0.3 + 0.4 * ((Math.sin(i * 0.9) + 1) / 2))).toFixed(2);
        ichiCandle.push([o, c, l, h]);
        ichiClose.push(c);
        ichiHigh.push(h);
        ichiLow.push(l);
      }
    }

    // (N期間高値 + N期間安値) / 2
    function ichiMidHL(hArr, lArr, n, idx) {
      if (idx < n - 1) return null;
      const hs = hArr.slice(idx - n + 1, idx + 1);
      const ls = lArr.slice(idx - n + 1, idx + 1);
      return +((Math.max(...hs) + Math.min(...ls)) / 2).toFixed(3);
    }

    // 転換線・基準線
    const tenkan   = Array.from({length: ichiN}, (_, i) => ichiMidHL(ichiHigh, ichiLow, tenkanP, i));
    const kijunArr = Array.from({length: ichiN}, (_, i) => ichiMidHL(ichiHigh, ichiLow, kijunP, i));

    // 先行スパンA = (転換 + 基準) / 2、ichiDisp 期間先行
    const spanA = new Array(ichiN + ichiDisp).fill(null);
    for (let i = 0; i < ichiN; i++) {
      if (tenkan[i] !== null && kijunArr[i] !== null)
        spanA[i + ichiDisp] = +((tenkan[i] + kijunArr[i]) / 2).toFixed(3);
    }

    // 先行スパンB = midHL(spanBP)、ichiDisp 期間先行
    const spanB = new Array(ichiN + ichiDisp).fill(null);
    for (let i = 0; i < ichiN; i++) {
      const val = ichiMidHL(ichiHigh, ichiLow, spanBP, i);
      if (val !== null) spanB[i + ichiDisp] = val;
    }

    // 遅行スパン = 終値を ichiDisp 期間遅行させてプロット
    const chikouSpan = new Array(ichiN + ichiDisp).fill(null);
    for (let i = ichiDisp; i < ichiN; i++) {
      chikouSpan[i - ichiDisp] = ichiClose[i];
    }

    // xAxis カテゴリ数に合わせてパディング
    const totalLen = ichiN + ichiDisp;
    const ichiPad = (arr) => arr.length < totalLen ? arr.concat(new Array(totalLen - arr.length).fill(null)) : arr;
    const tenkanPad  = ichiPad(tenkan);
    const kijunPad   = ichiPad(kijunArr);
    const candlePad  = ichiCandle.concat(new Array(ichiDisp).fill('-'));

    const chartIchi = echarts.init(document.getElementById('chart-ichimoku'));
    chartIchi.setOption({
      backgroundColor: 'transparent',
      tooltip: { trigger: 'axis', axisPointer: { type: 'cross' } },
      legend: { show: false },
      xAxis: {
        type: 'category',
        data: ichiDates,
        boundaryGap: true,
        axisLabel: { color: '#94a3b8', rotate: 30, fontSize: 10 },
        axisLine: { lineStyle: { color: '#334155' } }
      },
      yAxis: {
        scale: true,
        axisLabel: { color: '#94a3b8' },
        splitLine: { lineStyle: { color: '#1e293b' } }
      },
      grid: { left: 50, right: 20, bottom: 50, top: 20 },
      dataZoom: [{ type: 'inside', start: 0, end: 100 }],
      series: [
        // 雲（custom series — SpanA/SpanB 間をポリゴンで塗りつぶし）
        {
          name: '雲',
          type: 'custom',
          renderItem: function(params, api) {
            var idx = params.dataIndex;
            var nextIdx = idx + 1;
            if (nextIdx >= totalLen) return;
            var a0 = spanA[idx], b0 = spanB[idx];
            var a1 = spanA[nextIdx], b1 = spanB[nextIdx];
            if (a0 == null || b0 == null || a1 == null || b1 == null) return;

            var p0A = api.coord([idx, a0]);
            var p1A = api.coord([nextIdx, a1]);
            var p1B = api.coord([nextIdx, b1]);
            var p0B = api.coord([idx, b0]);

            // 好転（SpanA >= SpanB）なら緑、逆転なら赤橙
            var midA = (a0 + a1) / 2;
            var midB = (b0 + b1) / 2;
            var fillColor = midA >= midB
              ? 'rgba(74, 222, 128, 0.22)'
              : 'rgba(251, 146, 60, 0.22)';

            return {
              type: 'polygon',
              shape: { points: [p0A, p1A, p1B, p0B] },
              style: { fill: fillColor },
              silent: true
            };
          },
          data: Array.from({length: totalLen}, function(_, i) { return [i]; }),
          z: 1
        },
        // 先行スパンA
        {
          name: '先行スパンA', type: 'line', data: spanA,
          showSymbol: false, lineStyle: { color: '#4ade80', width: 1.5 },
          z: 3
        },
        // 先行スパンB
        {
          name: '先行スパンB', type: 'line', data: spanB,
          showSymbol: false, lineStyle: { color: '#fb923c', width: 1.5 },
          z: 3
        },
        // 転換線
        {
          name: '転換線', type: 'line', data: tenkanPad,
          showSymbol: false, lineStyle: { color: '#f87171', width: 2 },
          z: 4
        },
        // 基準線
        {
          name: '基準線', type: 'line', data: kijunPad,
          showSymbol: false, lineStyle: { color: '#60a5fa', width: 2 },
          z: 4
        },
        // 遅行スパン
        {
          name: '遅行スパン', type: 'line', data: chikouSpan,
          showSymbol: false, lineStyle: { color: '#c084fc', width: 1.5, type: 'dotted' },
          z: 4
        },
        // ローソク足
        {
          type: 'candlestick', data: candlePad,
          itemStyle: {
            color: '#38bdf8', color0: '#f87171',
            borderColor: '#38bdf8', borderColor0: '#f87171'
          },
          z: 5
        }
      ]
    });

    /* ========================================
       リサイズ対応
    ======================================== */
    window.addEventListener('resize', () => {
      chartCandles.resize();
      chartRsi.resize();
      chartMacd.resize();
      chartHist.resize();
      chartStoch.resize();
      chartBB.resize();
      chartIchi.resize();
    });
  </script>
</body>
</html>

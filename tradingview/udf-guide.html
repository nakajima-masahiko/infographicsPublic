<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TradingView UDF 完全ガイド - Universal Data Feed</title>
  <style>
    :root {
      color-scheme: light;
      font-family: "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
      --tv-primary: #2962ff;
      --tv-dark: #131722;
      --tv-gray: #787b86;
      --tv-light: #f0f3fa;
      --tv-green: #26a69a;
      --tv-red: #ef5350;
      --code-bg: #1e222d;
      --endpoint-config: #ff9800;
      --endpoint-search: #9c27b0;
      --endpoint-symbols: #00bcd4;
      --endpoint-history: #4caf50;
      --endpoint-time: #e91e63;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: linear-gradient(135deg, #131722 0%, #1e222d 100%);
      color: #d1d4dc;
      min-height: 100vh;
    }
    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 20px 60px;
    }
    header {
      text-align: center;
      margin-bottom: 32px;
      color: #ffffff;
    }
    header h1 {
      font-size: 36px;
      margin: 0 0 12px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    header h1 .logo {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--tv-primary), #1976d2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }
    header p {
      margin: 0;
      color: rgba(255,255,255,0.8);
      font-size: 16px;
    }
    .main-container {
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      overflow: hidden;
    }

    /* Hero Section */
    .hero {
      background: linear-gradient(135deg, var(--tv-dark) 0%, #2a2e39 100%);
      padding: 40px;
      color: #ffffff;
      text-align: center;
    }
    .hero h2 {
      font-size: 26px;
      margin: 0 0 16px;
      color: var(--tv-primary);
    }
    .hero p {
      font-size: 15px;
      opacity: 0.9;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.8;
    }

    /* Architecture Diagram */
    .architecture {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .arch-box {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px 30px;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .arch-box .icon {
      font-size: 36px;
      margin-bottom: 10px;
    }
    .arch-box .label {
      font-size: 14px;
      font-weight: 600;
    }
    .arch-arrow {
      font-size: 24px;
      color: var(--tv-primary);
    }

    /* Section Title */
    .section-title {
      text-align: center;
      font-size: 24px;
      color: var(--tv-dark);
      margin: 0 0 32px;
      position: relative;
    }
    .section-title::after {
      content: '';
      display: block;
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, var(--tv-primary), #1976d2);
      margin: 16px auto 0;
      border-radius: 2px;
    }

    /* Content Section */
    .content-section {
      padding: 50px 40px;
      background: #f7f9fa;
    }
    .content-section.dark {
      background: #ffffff;
    }

    .category-group {
      margin-bottom: 40px;
    }
    .category-group:last-child {
      margin-bottom: 0;
    }
    .category-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e1e8ed;
    }
    .category-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      color: white;
    }
    .category-badge.config { background: var(--endpoint-config); }
    .category-badge.search { background: var(--endpoint-search); }
    .category-badge.symbols { background: var(--endpoint-symbols); }
    .category-badge.history { background: var(--endpoint-history); }
    .category-badge.time { background: var(--endpoint-time); }
    .category-badge.overview { background: var(--tv-primary); }

    .content-grid {
      display: grid;
      gap: 20px;
    }

    /* Content Card */
    .content-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border-left: 4px solid var(--tv-primary);
      transition: all 0.3s ease;
    }
    .content-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    }
    .content-card.config { border-left-color: var(--endpoint-config); }
    .content-card.search { border-left-color: var(--endpoint-search); }
    .content-card.symbols { border-left-color: var(--endpoint-symbols); }
    .content-card.history { border-left-color: var(--endpoint-history); }
    .content-card.time { border-left-color: var(--endpoint-time); }

    .card-header {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 16px;
    }
    .card-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: white;
      flex-shrink: 0;
    }
    .card-icon.config { background: linear-gradient(135deg, var(--endpoint-config), #f57c00); }
    .card-icon.search { background: linear-gradient(135deg, var(--endpoint-search), #7b1fa2); }
    .card-icon.symbols { background: linear-gradient(135deg, var(--endpoint-symbols), #0097a7); }
    .card-icon.history { background: linear-gradient(135deg, var(--endpoint-history), #388e3c); }
    .card-icon.time { background: linear-gradient(135deg, var(--endpoint-time), #c2185b); }
    .card-icon.overview { background: linear-gradient(135deg, var(--tv-primary), #1976d2); }

    .card-info {
      flex: 1;
    }
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--tv-dark);
      margin: 0 0 4px;
    }
    .card-subtitle {
      display: inline-block;
      background: var(--code-bg);
      padding: 4px 10px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 13px;
      color: var(--tv-green);
      border: 1px solid #3a3f4b;
    }
    .http-method {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
      margin-right: 8px;
    }
    .http-method.get {
      background: #e3f2fd;
      color: #1565c0;
    }
    .card-description {
      font-size: 14px;
      color: var(--tv-gray);
      line-height: 1.7;
      margin-bottom: 16px;
    }

    /* Code Block */
    .code-block {
      background: var(--code-bg);
      border-radius: 10px;
      padding: 16px;
      overflow-x: auto;
      margin: 12px 0;
    }
    .code-block code {
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 13px;
      color: #d1d4dc;
      line-height: 1.6;
      white-space: pre;
    }
    .code-block .comment { color: #6a6d78; }
    .code-block .string { color: #a5d6ff; }
    .code-block .keyword { color: #ff7b72; }
    .code-block .property { color: #79c0ff; }
    .code-block .number { color: #f2cc60; }
    .code-block .boolean { color: #ff9800; }

    /* Parameters */
    .params-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--tv-dark);
      margin: 20px 0 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .params-list {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 16px;
      border: 1px solid #e1e8ed;
    }
    .param-item {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
      font-size: 13px;
    }
    .param-item:last-child {
      margin-bottom: 0;
    }
    .param-name {
      font-family: monospace;
      background: #ffffff;
      padding: 3px 8px;
      border-radius: 4px;
      color: #d73a49;
      border: 1px solid #e1e8ed;
      font-weight: 600;
    }
    .param-type {
      font-family: monospace;
      color: var(--endpoint-search);
      font-size: 12px;
    }
    .param-required {
      background: #fef2f2;
      color: #dc2626;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
    }
    .param-optional {
      background: #f0fdf4;
      color: #16a34a;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
    }
    .param-desc {
      width: 100%;
      color: var(--tv-gray);
      padding-left: 16px;
      border-left: 2px solid #e1e8ed;
      margin-top: 4px;
    }

    /* Response Fields */
    .response-fields {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 10px;
      padding: 16px;
      margin-top: 16px;
    }
    .response-fields h5 {
      margin: 0 0 12px;
      font-size: 13px;
      color: var(--tv-dark);
    }
    .field-item {
      display: flex;
      align-items: baseline;
      gap: 12px;
      margin-bottom: 8px;
      font-size: 13px;
    }
    .field-item:last-child {
      margin-bottom: 0;
    }
    .field-name {
      font-family: monospace;
      color: var(--endpoint-history);
      font-weight: 600;
      min-width: 150px;
    }
    .field-desc {
      color: var(--tv-gray);
    }

    /* Notice Box */
    .notice {
      background: #fef3c7;
      border: 1px solid #f59e0b;
      border-radius: 10px;
      padding: 16px;
      margin: 16px 0;
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }
    .notice.info {
      background: #dbeafe;
      border-color: #3b82f6;
    }
    .notice.success {
      background: #dcfce7;
      border-color: #22c55e;
    }
    .notice-icon {
      font-size: 20px;
      flex-shrink: 0;
    }
    .notice-text {
      font-size: 13px;
      color: var(--tv-dark);
      line-height: 1.6;
    }

    /* Flow Diagram */
    .flow-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin: 20px 0;
    }
    .flow-step {
      display: flex;
      align-items: center;
      gap: 16px;
      background: #f8f9fa;
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #e1e8ed;
    }
    .flow-number {
      width: 32px;
      height: 32px;
      background: var(--tv-primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      flex-shrink: 0;
    }
    .flow-content {
      flex: 1;
    }
    .flow-endpoint {
      font-family: monospace;
      font-size: 14px;
      font-weight: 600;
      color: var(--tv-primary);
      margin-bottom: 4px;
    }
    .flow-desc {
      font-size: 13px;
      color: var(--tv-gray);
    }

    /* Supported Resolutions */
    .resolution-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
      margin-top: 12px;
    }
    .resolution-item {
      background: var(--code-bg);
      color: #d1d4dc;
      padding: 8px 12px;
      border-radius: 6px;
      text-align: center;
      font-family: monospace;
      font-size: 13px;
      font-weight: 600;
    }
    .resolution-item .label {
      font-size: 10px;
      color: #787b86;
      display: block;
      margin-top: 4px;
    }

    /* Footer */
    .footer {
      padding: 30px 40px;
      background: var(--tv-dark);
      color: #ffffff;
      text-align: center;
    }
    .footer p {
      margin: 0;
      font-size: 14px;
      opacity: 0.8;
    }
    .footer a {
      color: var(--tv-primary);
      text-decoration: none;
    }
    .footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      header h1 {
        font-size: 28px;
      }
      .content-section {
        padding: 30px 20px;
      }
      .content-card {
        padding: 20px;
      }
      .card-header {
        flex-direction: column;
        gap: 12px;
      }
      .architecture {
        flex-direction: column;
      }
      .arch-arrow {
        transform: rotate(90deg);
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>
        <span class="logo">&#128200;</span>
        TradingView UDF ガイド
      </h1>
      <p>Universal Data Feed - チャートライブラリとバックエンドを繋ぐHTTPプロトコル</p>
    </header>

    <div class="main-container">
      <!-- Hero Section -->
      <section class="hero">
        <h2>Universal Data Feed (UDF) とは</h2>
        <p>
          UDFは、TradingViewチャートライブラリにデータを提供するための
          シンプルなHTTPベースのプロトコルです。
          バックエンドサーバーで必要なエンドポイントを実装することで、
          カスタムデータソースからのデータをチャートに表示できます。
        </p>

        <div class="architecture">
          <div class="arch-box">
            <div class="icon">&#128187;</div>
            <div class="label">TradingView<br>チャートライブラリ</div>
          </div>
          <div class="arch-arrow">&#8594;</div>
          <div class="arch-box">
            <div class="icon">&#128259;</div>
            <div class="label">UDF<br>アダプター</div>
          </div>
          <div class="arch-arrow">&#8594;</div>
          <div class="arch-box">
            <div class="icon">&#128451;</div>
            <div class="label">バックエンド<br>サーバー</div>
          </div>
          <div class="arch-arrow">&#8594;</div>
          <div class="arch-box">
            <div class="icon">&#128202;</div>
            <div class="label">データ<br>ソース</div>
          </div>
        </div>
      </section>

      <!-- Overview Section -->
      <section class="content-section">
        <h3 class="section-title">UDFの仕組み</h3>

        <div class="content-grid">
          <div class="content-card">
            <div class="card-header">
              <div class="card-icon overview">&#128220;</div>
              <div class="card-info">
                <h4 class="card-title">Datafeed APIの実装方法</h4>
              </div>
            </div>
            <p class="card-description">
              TradingViewチャートライブラリは、データを取得するために
              <strong>Datafeed API</strong>というJavaScriptインターフェースを使用します。
              UDFは、このDatafeed APIの既製アダプターで、HTTPリクエストを使用してバックエンドと通信します。
            </p>

            <div class="notice info">
              <span class="notice-icon">&#128161;</span>
              <span class="notice-text">
                UDFを使用する場合、JavaScriptでDatafeed APIを実装する必要はありません。
                代わりに、バックエンドで指定されたHTTPエンドポイントを実装するだけでOKです。
              </span>
            </div>

            <div class="params-title">&#128640; データフローの流れ</div>
            <div class="flow-container">
              <div class="flow-step">
                <div class="flow-number">1</div>
                <div class="flow-content">
                  <div class="flow-endpoint">/config</div>
                  <div class="flow-desc">ライブラリ初期化時にサーバーの設定情報を取得</div>
                </div>
              </div>
              <div class="flow-step">
                <div class="flow-number">2</div>
                <div class="flow-content">
                  <div class="flow-endpoint">/search</div>
                  <div class="flow-desc">ユーザーがシンボルを検索する際に呼び出し</div>
                </div>
              </div>
              <div class="flow-step">
                <div class="flow-number">3</div>
                <div class="flow-content">
                  <div class="flow-endpoint">/symbols</div>
                  <div class="flow-desc">選択されたシンボルの詳細情報を取得</div>
                </div>
              </div>
              <div class="flow-step">
                <div class="flow-number">4</div>
                <div class="flow-content">
                  <div class="flow-endpoint">/history</div>
                  <div class="flow-desc">OHLCVバーデータを取得してチャートを描画</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Endpoints Section -->
      <section class="content-section dark">
        <h3 class="section-title">UDFエンドポイント詳細</h3>

        <!-- /config -->
        <div class="category-group">
          <div class="category-header">
            <span class="category-badge config">&#9881; /config</span>
          </div>
          <div class="content-grid">
            <div class="content-card config">
              <div class="card-header">
                <div class="card-icon config">&#9881;</div>
                <div class="card-info">
                  <h4 class="card-title">設定エンドポイント</h4>
                  <code class="card-subtitle"><span class="http-method get">GET</span>/config</code>
                </div>
              </div>
              <p class="card-description">
                UDFサーバーの機能や対応している時間足などの設定情報を返します。
                チャートライブラリの初期化時に一度だけ呼び出されます。
              </p>

              <div class="code-block">
                <code><span class="comment">// レスポンス例</span>
{
  <span class="property">"supports_search"</span>: <span class="boolean">true</span>,
  <span class="property">"supports_group_request"</span>: <span class="boolean">false</span>,
  <span class="property">"supports_marks"</span>: <span class="boolean">false</span>,
  <span class="property">"supports_timescale_marks"</span>: <span class="boolean">false</span>,
  <span class="property">"supports_time"</span>: <span class="boolean">true</span>,
  <span class="property">"exchanges"</span>: [
    { <span class="property">"value"</span>: <span class="string">""</span>, <span class="property">"name"</span>: <span class="string">"All Exchanges"</span>, <span class="property">"desc"</span>: <span class="string">""</span> },
    { <span class="property">"value"</span>: <span class="string">"NYSE"</span>, <span class="property">"name"</span>: <span class="string">"NYSE"</span>, <span class="property">"desc"</span>: <span class="string">"New York Stock Exchange"</span> },
    { <span class="property">"value"</span>: <span class="string">"NASDAQ"</span>, <span class="property">"name"</span>: <span class="string">"NASDAQ"</span>, <span class="property">"desc"</span>: <span class="string">"NASDAQ"</span> }
  ],
  <span class="property">"symbols_types"</span>: [
    { <span class="property">"name"</span>: <span class="string">"All types"</span>, <span class="property">"value"</span>: <span class="string">""</span> },
    { <span class="property">"name"</span>: <span class="string">"Stock"</span>, <span class="property">"value"</span>: <span class="string">"stock"</span> },
    { <span class="property">"name"</span>: <span class="string">"Crypto"</span>, <span class="property">"value"</span>: <span class="string">"crypto"</span> }
  ],
  <span class="property">"supported_resolutions"</span>: [<span class="string">"1"</span>, <span class="string">"5"</span>, <span class="string">"15"</span>, <span class="string">"30"</span>, <span class="string">"60"</span>, <span class="string">"D"</span>, <span class="string">"W"</span>, <span class="string">"M"</span>]
}</code>
              </div>

              <div class="response-fields">
                <h5>&#128203; 主要レスポンスフィールド</h5>
                <div class="field-item">
                  <span class="field-name">supports_search</span>
                  <span class="field-desc">シンボル検索機能をサポートするか</span>
                </div>
                <div class="field-item">
                  <span class="field-name">supports_marks</span>
                  <span class="field-desc">チャート上のマーク表示をサポートするか</span>
                </div>
                <div class="field-item">
                  <span class="field-name">supports_time</span>
                  <span class="field-desc">/timeエンドポイントをサポートするか</span>
                </div>
                <div class="field-item">
                  <span class="field-name">supported_resolutions</span>
                  <span class="field-desc">対応する時間足の配列</span>
                </div>
              </div>

              <div class="params-title">&#128337; 対応時間足の例</div>
              <div class="resolution-grid">
                <div class="resolution-item">1<span class="label">1分</span></div>
                <div class="resolution-item">5<span class="label">5分</span></div>
                <div class="resolution-item">15<span class="label">15分</span></div>
                <div class="resolution-item">30<span class="label">30分</span></div>
                <div class="resolution-item">60<span class="label">1時間</span></div>
                <div class="resolution-item">D<span class="label">日足</span></div>
                <div class="resolution-item">W<span class="label">週足</span></div>
                <div class="resolution-item">M<span class="label">月足</span></div>
              </div>
            </div>
          </div>
        </div>

        <!-- /search -->
        <div class="category-group">
          <div class="category-header">
            <span class="category-badge search">&#128269; /search</span>
          </div>
          <div class="content-grid">
            <div class="content-card search">
              <div class="card-header">
                <div class="card-icon search">&#128269;</div>
                <div class="card-info">
                  <h4 class="card-title">シンボル検索エンドポイント</h4>
                  <code class="card-subtitle"><span class="http-method get">GET</span>/search?query=...&amp;limit=...</code>
                </div>
              </div>
              <p class="card-description">
                ユーザーが入力した検索クエリに基づいてシンボルを検索し、
                マッチするシンボルのリストを返します。
              </p>

              <div class="params-title">&#128221; リクエストパラメータ</div>
              <div class="params-list">
                <div class="param-item">
                  <span class="param-name">query</span>
                  <span class="param-type">string</span>
                  <span class="param-required">必須</span>
                  <div class="param-desc">検索文字列（例: "AAPL", "Bitcoin"）</div>
                </div>
                <div class="param-item">
                  <span class="param-name">type</span>
                  <span class="param-type">string</span>
                  <span class="param-optional">オプション</span>
                  <div class="param-desc">シンボルタイプでフィルタ（例: "stock", "crypto"）</div>
                </div>
                <div class="param-item">
                  <span class="param-name">exchange</span>
                  <span class="param-type">string</span>
                  <span class="param-optional">オプション</span>
                  <div class="param-desc">取引所でフィルタ（例: "NYSE", "BINANCE"）</div>
                </div>
                <div class="param-item">
                  <span class="param-name">limit</span>
                  <span class="param-type">integer</span>
                  <span class="param-optional">オプション</span>
                  <div class="param-desc">返す結果の最大数（デフォルト: 30）</div>
                </div>
              </div>

              <div class="code-block">
                <code><span class="comment">// GET /search?query=AAPL&limit=10</span>
<span class="comment">// レスポンス例</span>
[
  {
    <span class="property">"symbol"</span>: <span class="string">"AAPL"</span>,
    <span class="property">"full_name"</span>: <span class="string">"NASDAQ:AAPL"</span>,
    <span class="property">"description"</span>: <span class="string">"Apple Inc."</span>,
    <span class="property">"exchange"</span>: <span class="string">"NASDAQ"</span>,
    <span class="property">"type"</span>: <span class="string">"stock"</span>
  },
  {
    <span class="property">"symbol"</span>: <span class="string">"AAPL.MX"</span>,
    <span class="property">"full_name"</span>: <span class="string">"BMV:AAPL.MX"</span>,
    <span class="property">"description"</span>: <span class="string">"Apple Inc. (Mexico)"</span>,
    <span class="property">"exchange"</span>: <span class="string">"BMV"</span>,
    <span class="property">"type"</span>: <span class="string">"stock"</span>
  }
]</code>
              </div>
            </div>
          </div>
        </div>

        <!-- /symbols -->
        <div class="category-group">
          <div class="category-header">
            <span class="category-badge symbols">&#128196; /symbols</span>
          </div>
          <div class="content-grid">
            <div class="content-card symbols">
              <div class="card-header">
                <div class="card-icon symbols">&#128196;</div>
                <div class="card-info">
                  <h4 class="card-title">シンボル情報エンドポイント</h4>
                  <code class="card-subtitle"><span class="http-method get">GET</span>/symbols?symbol=...</code>
                </div>
              </div>
              <p class="card-description">
                指定されたシンボルの詳細情報（メタデータ）を返します。
                チャートの表示設定やデータ取得に必要な情報が含まれます。
              </p>

              <div class="params-title">&#128221; リクエストパラメータ</div>
              <div class="params-list">
                <div class="param-item">
                  <span class="param-name">symbol</span>
                  <span class="param-type">string</span>
                  <span class="param-required">必須</span>
                  <div class="param-desc">シンボル名（例: "AAPL", "BTCUSDT"）</div>
                </div>
              </div>

              <div class="code-block">
                <code><span class="comment">// GET /symbols?symbol=AAPL</span>
<span class="comment">// レスポンス例</span>
{
  <span class="property">"name"</span>: <span class="string">"AAPL"</span>,
  <span class="property">"ticker"</span>: <span class="string">"AAPL"</span>,
  <span class="property">"description"</span>: <span class="string">"Apple Inc."</span>,
  <span class="property">"type"</span>: <span class="string">"stock"</span>,
  <span class="property">"session"</span>: <span class="string">"0930-1600"</span>,
  <span class="property">"exchange"</span>: <span class="string">"NASDAQ"</span>,
  <span class="property">"listed_exchange"</span>: <span class="string">"NASDAQ"</span>,
  <span class="property">"timezone"</span>: <span class="string">"America/New_York"</span>,
  <span class="property">"minmov"</span>: <span class="number">1</span>,
  <span class="property">"pricescale"</span>: <span class="number">100</span>,
  <span class="property">"has_intraday"</span>: <span class="boolean">true</span>,
  <span class="property">"has_daily"</span>: <span class="boolean">true</span>,
  <span class="property">"has_weekly_and_monthly"</span>: <span class="boolean">true</span>,
  <span class="property">"supported_resolutions"</span>: [<span class="string">"1"</span>, <span class="string">"5"</span>, <span class="string">"15"</span>, <span class="string">"60"</span>, <span class="string">"D"</span>, <span class="string">"W"</span>],
  <span class="property">"currency_code"</span>: <span class="string">"USD"</span>
}</code>
              </div>

              <div class="response-fields">
                <h5>&#128203; 主要レスポンスフィールド</h5>
                <div class="field-item">
                  <span class="field-name">name / ticker</span>
                  <span class="field-desc">シンボル識別子</span>
                </div>
                <div class="field-item">
                  <span class="field-name">session</span>
                  <span class="field-desc">取引時間（HHMM-HHMM形式）</span>
                </div>
                <div class="field-item">
                  <span class="field-name">timezone</span>
                  <span class="field-desc">タイムゾーン（IANA形式）</span>
                </div>
                <div class="field-item">
                  <span class="field-name">minmov / pricescale</span>
                  <span class="field-desc">最小値動き単位（minmov/pricescale = 最小変動幅）</span>
                </div>
                <div class="field-item">
                  <span class="field-name">has_intraday</span>
                  <span class="field-desc">分足データが利用可能か</span>
                </div>
              </div>

              <div class="notice">
                <span class="notice-icon">&#9888;</span>
                <span class="notice-text">
                  <strong>pricescale</strong>は価格の表示精度を決定します。
                  例: pricescale=100 は小数点以下2桁（0.01単位）、
                  pricescale=100000000 は暗号通貨のような8桁精度を表します。
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- /history -->
        <div class="category-group">
          <div class="category-header">
            <span class="category-badge history">&#128200; /history</span>
          </div>
          <div class="content-grid">
            <div class="content-card history">
              <div class="card-header">
                <div class="card-icon history">&#128200;</div>
                <div class="card-info">
                  <h4 class="card-title">履歴データエンドポイント</h4>
                  <code class="card-subtitle"><span class="http-method get">GET</span>/history?symbol=...&amp;resolution=...&amp;from=...&amp;to=...</code>
                </div>
              </div>
              <p class="card-description">
                指定された期間のOHLCV（始値・高値・安値・終値・出来高）データを返します。
                これがチャートのローソク足データになります。
              </p>

              <div class="params-title">&#128221; リクエストパラメータ</div>
              <div class="params-list">
                <div class="param-item">
                  <span class="param-name">symbol</span>
                  <span class="param-type">string</span>
                  <span class="param-required">必須</span>
                  <div class="param-desc">シンボル名</div>
                </div>
                <div class="param-item">
                  <span class="param-name">resolution</span>
                  <span class="param-type">string</span>
                  <span class="param-required">必須</span>
                  <div class="param-desc">時間足（"1", "5", "15", "60", "D", "W", "M"）</div>
                </div>
                <div class="param-item">
                  <span class="param-name">from</span>
                  <span class="param-type">integer</span>
                  <span class="param-required">必須</span>
                  <div class="param-desc">開始時刻（UNIXタイムスタンプ・秒）</div>
                </div>
                <div class="param-item">
                  <span class="param-name">to</span>
                  <span class="param-type">integer</span>
                  <span class="param-required">必須</span>
                  <div class="param-desc">終了時刻（UNIXタイムスタンプ・秒）</div>
                </div>
                <div class="param-item">
                  <span class="param-name">countback</span>
                  <span class="param-type">integer</span>
                  <span class="param-optional">オプション</span>
                  <div class="param-desc">toから遡って取得するバー数</div>
                </div>
              </div>

              <div class="code-block">
                <code><span class="comment">// GET /history?symbol=AAPL&resolution=D&from=1640995200&to=1672531200</span>
<span class="comment">// レスポンス例（成功時）</span>
{
  <span class="property">"s"</span>: <span class="string">"ok"</span>,
  <span class="property">"t"</span>: [<span class="number">1640995200</span>, <span class="number">1641081600</span>, <span class="number">1641168000</span>],
  <span class="property">"o"</span>: [<span class="number">177.83</span>, <span class="number">182.63</span>, <span class="number">179.61</span>],
  <span class="property">"h"</span>: [<span class="number">182.88</span>, <span class="number">182.94</span>, <span class="number">180.17</span>],
  <span class="property">"l"</span>: [<span class="number">177.71</span>, <span class="number">179.12</span>, <span class="number">174.64</span>],
  <span class="property">"c"</span>: [<span class="number">182.01</span>, <span class="number">179.70</span>, <span class="number">174.92</span>],
  <span class="property">"v"</span>: [<span class="number">104487900</span>, <span class="number">99310400</span>, <span class="number">96904000</span>]
}

<span class="comment">// データなしの場合</span>
{
  <span class="property">"s"</span>: <span class="string">"no_data"</span>,
  <span class="property">"nextTime"</span>: <span class="number">1640000000</span>
}</code>
              </div>

              <div class="response-fields">
                <h5>&#128203; レスポンスフィールド</h5>
                <div class="field-item">
                  <span class="field-name">s</span>
                  <span class="field-desc">ステータス（"ok" または "no_data"）</span>
                </div>
                <div class="field-item">
                  <span class="field-name">t</span>
                  <span class="field-desc">タイムスタンプ配列（UNIXタイムスタンプ・秒）</span>
                </div>
                <div class="field-item">
                  <span class="field-name">o</span>
                  <span class="field-desc">始値（Open）配列</span>
                </div>
                <div class="field-item">
                  <span class="field-name">h</span>
                  <span class="field-desc">高値（High）配列</span>
                </div>
                <div class="field-item">
                  <span class="field-name">l</span>
                  <span class="field-desc">安値（Low）配列</span>
                </div>
                <div class="field-item">
                  <span class="field-name">c</span>
                  <span class="field-desc">終値（Close）配列</span>
                </div>
                <div class="field-item">
                  <span class="field-name">v</span>
                  <span class="field-desc">出来高（Volume）配列</span>
                </div>
              </div>

              <div class="notice success">
                <span class="notice-icon">&#10003;</span>
                <span class="notice-text">
                  配列の各インデックスは対応しています。
                  例: t[0]の時刻に対応する始値はo[0]、高値はh[0]...となります。
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- /time -->
        <div class="category-group">
          <div class="category-header">
            <span class="category-badge time">&#128337; /time</span>
          </div>
          <div class="content-grid">
            <div class="content-card time">
              <div class="card-header">
                <div class="card-icon time">&#128337;</div>
                <div class="card-info">
                  <h4 class="card-title">サーバー時刻エンドポイント</h4>
                  <code class="card-subtitle"><span class="http-method get">GET</span>/time</code>
                </div>
              </div>
              <p class="card-description">
                サーバーの現在時刻をUNIXタイムスタンプ（秒）で返します。
                クライアントとサーバー間の時刻同期に使用されます。
              </p>

              <div class="code-block">
                <code><span class="comment">// GET /time</span>
<span class="comment">// レスポンス例</span>
<span class="number">1706745600</span></code>
              </div>

              <div class="notice info">
                <span class="notice-icon">&#128161;</span>
                <span class="notice-text">
                  このエンドポイントは <code>supports_time: true</code> が設定されている場合のみ呼び出されます。
                </span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Implementation Tips -->
      <section class="content-section">
        <h3 class="section-title">実装のポイント</h3>

        <div class="content-grid">
          <div class="content-card">
            <div class="card-header">
              <div class="card-icon overview">&#128736;</div>
              <div class="card-info">
                <h4 class="card-title">バックエンド実装例（Node.js/Express）</h4>
              </div>
            </div>

            <div class="code-block">
              <code><span class="keyword">const</span> express = require(<span class="string">'express'</span>);
<span class="keyword">const</span> app = express();

<span class="comment">// CORS設定（重要）</span>
app.use((<span class="property">req</span>, <span class="property">res</span>, <span class="property">next</span>) => {
  res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'*'</span>);
  next();
});

<span class="comment">// /config エンドポイント</span>
app.get(<span class="string">'/config'</span>, (<span class="property">req</span>, <span class="property">res</span>) => {
  res.json({
    <span class="property">supports_search</span>: <span class="boolean">true</span>,
    <span class="property">supports_time</span>: <span class="boolean">true</span>,
    <span class="property">supported_resolutions</span>: [<span class="string">'1'</span>, <span class="string">'5'</span>, <span class="string">'15'</span>, <span class="string">'60'</span>, <span class="string">'D'</span>]
  });
});

<span class="comment">// /history エンドポイント</span>
app.get(<span class="string">'/history'</span>, <span class="keyword">async</span> (<span class="property">req</span>, <span class="property">res</span>) => {
  <span class="keyword">const</span> { symbol, resolution, from, to } = req.query;

  <span class="comment">// データソースからOHLCVデータを取得</span>
  <span class="keyword">const</span> bars = <span class="keyword">await</span> fetchBarsFromDatabase(symbol, resolution, from, to);

  <span class="keyword">if</span> (bars.length === <span class="number">0</span>) {
    <span class="keyword">return</span> res.json({ <span class="property">s</span>: <span class="string">'no_data'</span> });
  }

  res.json({
    <span class="property">s</span>: <span class="string">'ok'</span>,
    <span class="property">t</span>: bars.map(<span class="property">b</span> => b.timestamp),
    <span class="property">o</span>: bars.map(<span class="property">b</span> => b.open),
    <span class="property">h</span>: bars.map(<span class="property">b</span> => b.high),
    <span class="property">l</span>: bars.map(<span class="property">b</span> => b.low),
    <span class="property">c</span>: bars.map(<span class="property">b</span> => b.close),
    <span class="property">v</span>: bars.map(<span class="property">b</span> => b.volume)
  });
});

app.listen(<span class="number">3000</span>);</code>
            </div>
          </div>

          <div class="content-card">
            <div class="card-header">
              <div class="card-icon overview">&#127919;</div>
              <div class="card-info">
                <h4 class="card-title">よくある注意点</h4>
              </div>
            </div>

            <ul style="list-style: none; padding: 0; margin: 0;">
              <li style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 16px; padding: 16px; background: #fef2f2; border-radius: 8px; border-left: 3px solid #ef4444;">
                <span style="font-size: 20px;">&#9888;</span>
                <div>
                  <strong style="color: #dc2626;">CORS設定を忘れずに</strong>
                  <p style="margin: 8px 0 0; color: #6b7280; font-size: 13px;">
                    ブラウザからのリクエストを許可するため、Access-Control-Allow-Originヘッダーが必要です。
                  </p>
                </div>
              </li>
              <li style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 16px; padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 3px solid #f59e0b;">
                <span style="font-size: 20px;">&#128337;</span>
                <div>
                  <strong style="color: #d97706;">タイムスタンプは秒単位</strong>
                  <p style="margin: 8px 0 0; color: #6b7280; font-size: 13px;">
                    JavaScriptのDate.now()はミリ秒を返すので、1000で割ることを忘れずに。
                  </p>
                </div>
              </li>
              <li style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 16px; padding: 16px; background: #dbeafe; border-radius: 8px; border-left: 3px solid #3b82f6;">
                <span style="font-size: 20px;">&#128290;</span>
                <div>
                  <strong style="color: #1d4ed8;">pricescaleの設定</strong>
                  <p style="margin: 8px 0 0; color: #6b7280; font-size: 13px;">
                    株式は通常100（2桁）、暗号通貨は100000000（8桁）が一般的です。
                  </p>
                </div>
              </li>
              <li style="display: flex; align-items: flex-start; gap: 10px; padding: 16px; background: #dcfce7; border-radius: 8px; border-left: 3px solid #22c55e;">
                <span style="font-size: 20px;">&#128202;</span>
                <div>
                  <strong style="color: #16a34a;">データの整合性</strong>
                  <p style="margin: 8px 0 0; color: #6b7280; font-size: 13px;">
                    t, o, h, l, c, v の各配列は同じ長さで、インデックスが対応している必要があります。
                  </p>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer class="footer">
        <p>TradingView UDF ガイド | 公式ドキュメント: <a href="https://www.tradingview.com/charting-library-docs/latest/connecting_data/UDF/" target="_blank">TradingView Docs</a></p>
      </footer>
    </div>
  </div>
</body>
</html>
